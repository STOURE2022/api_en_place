# Checklist DÃ©taillÃ©e - Outil d'Ingestion de DonnÃ©es

## ğŸ“‹ 1. CONTRÃ”LES SUR LES FICHIERS

### VÃ©rification des doublons
- [ ] **ContrÃ´ler que le fichier n'existe pas dÃ©jÃ **
  - Comparer le nom du fichier reÃ§u avec tous les fichiers dÃ©jÃ  ingÃ©rÃ©s
  - Si doublon dÃ©tectÃ© â†’ rejeter avec erreur 000000002

### Validation du nom de fichier
- [ ] **Extraire et valider la date du nom de fichier**
  - Exemples de formats : `billing_20251016_101112.csv` ou `fichier_2025/10/15.csv`
  - VÃ©rifier que la date est valide (pas de 32/13/2025)
  - Si invalide â†’ rejeter avec erreur 000000001

- [ ] **VÃ©rifier la partie fixe du nom**
  - Exemple : pour pattern `billing_yyyymmdd.csv`, vÃ©rifier que Ã§a commence par "billing"
  - Comparaison sensible Ã  la casse (Billing â‰  billing)
  - Si pas de correspondance â†’ rejeter avec erreur 000000001

### ContrÃ´le de l'ordre chronologique
- [ ] **VÃ©rifier que le fichier est plus rÃ©cent que le prÃ©cÃ©dent**
  - Comparer la date du fichier reÃ§u avec le dernier fichier ingÃ©rÃ©
  - Si date antÃ©rieure â†’ rejeter avec erreur 000000003
  - âš ï¸ Concerne uniquement l'ingestion jour aprÃ¨s jour (pas la rÃ©cupÃ©ration)

### Traitement des fichiers
- [ ] **DÃ©compresser les fichiers ZIP**
  - Si fichier = .zip â†’ dÃ©compresser
  - Copier les fichiers extraits vers le dossier RAW

- [ ] **Copier les fichiers non-zippÃ©s**
  - Si fichier â‰  .zip â†’ copier directement vers le dossier RAW

---

## ğŸ“Š 2. CONTRÃ”LES SUR LES DONNÃ‰ES

### Validation du schÃ©ma
- [ ] **VÃ©rifier le nombre de colonnes**
  - Compter les colonnes du fichier reÃ§u
  - Comparer avec le schÃ©ma dÃ©fini dans la configuration
  - Si diffÃ©rent â†’ rejeter avec erreur 000000006

### Validation des types de donnÃ©es
- [ ] **ContrÃ´ler les types pour chaque colonne**
  - Exemple : si colonne dÃ©finie comme "Integer", vÃ©rifier que c'est bien un nombre
  - Si type incorrect â†’ mettre la valeur Ã  NULL + appliquer la rÃ¨gle d'erreur
  - Exception : les dates ont un traitement spÃ©cial (voir ci-dessous)

### Gestion des valeurs NULL
- [ ] **VÃ©rifier les colonnes obligatoires**
  - Si colonne configurÃ©e comme "NOT Nullable" et valeur = NULL
  - â†’ Appliquer la rÃ¨gle d'erreur

### Traitement des dates
- [ ] **Valider le format des dates en entrÃ©e**
  - Exemples d'entrÃ©e : `15/10/2025`, `15Oct2025 10:10:10`, `2025-10-15`
  - VÃ©rifier que le format correspond au "transformation_pattern_date" configurÃ©
  - Si invalide â†’ mettre NULL + appliquer rÃ¨gle d'erreur

- [ ] **Convertir toutes les dates au format standard**
  - Format de sortie obligatoire : `yyyy-MM-dd HH:mm:ss`
  - Exemple : `15/10/2025` devient `2025-10-15 00:00:00`

### Transformations spÃ©ciales
- [ ] **Appliquer les transformations REGEX**
  - Exemple : extraire une partie du nom de fichier avec `.{25}$`
  - CrÃ©er une nouvelle colonne avec le rÃ©sultat

- [ ] **Enrichissement depuis le nom de fichier**
  - Type "filename-modified" : extraire des infos du nom du fichier
  - CrÃ©er une colonne technique avec ces infos

---

## ğŸ—ï¸ 3. CRÃ‰ATION DES TABLES DELTA

### Structure des tables
- [ ] **CrÃ©er 2 tables pour chaque source de donnÃ©es**
  - Table "Last" : `nom_table_last` (derniÃ¨res donnÃ©es uniquement)
  - Table "All" : `nom_table_all` (historique complet de tous les fichiers)

### Colonnes techniques obligatoires
- [ ] **Ajouter 4 colonnes au dÃ©but de chaque table**
  1. `FILE_LINE_ID` (Integer) : numÃ©ro de ligne unique
  2. `FILE_NAME_RECEIVED` (String) : nom du fichier source
  3. `FILE_EXTRACTION_DATE` (Timestamp) : date d'extraction du fichier
  4. `FILE_PROCESS_DATE` (Timestamp) : date d'ingestion (maintenant)

### Partitionnement (table "All" uniquement)
- [ ] **Ajouter les colonnes de partitionnement**
  - Si partition = `yyyy/mm/dd/hhmmss` â†’ crÃ©er colonnes : yyyy, mm, dd, hhmmss
  - Si partition = `yyyy/mm/dd` â†’ crÃ©er colonnes : yyyy, mm, dd
  - Si partition = `yyyy/mm` â†’ crÃ©er colonnes : yyyy, mm
  - Si partition = `yyyy` â†’ crÃ©er colonne : yyyy

### Conservation des donnÃ©es sources
- [ ] **PrÃ©server toutes les colonnes originales**
  - Toutes les colonnes du fichier source doivent Ãªtre prÃ©sentes en sortie
  - Ordre : colonnes techniques PUIS colonnes sources

---

## âš™ï¸ 4. GESTION DES EN-TÃŠTES

- [ ] **INPUT_HEADER = vide (par dÃ©faut)**
  - Utiliser les noms de colonnes dÃ©finis dans la configuration Excel
  - Ignorer complÃ¨tement la premiÃ¨re ligne du fichier

- [ ] **INPUT_HEADER = FIRST_LINE**
  - Il y a une ligne d'en-tÃªte dans le fichier
  - Sauter cette premiÃ¨re ligne lors de l'ingestion
  - Utiliser quand mÃªme les noms de la configuration (pas ceux du fichier)

- [ ] **INPUT_HEADER = HEADER_USE**
  - Utiliser les noms de colonnes de la premiÃ¨re ligne du fichier
  - Ignorer les noms dÃ©finis dans la configuration

---

## âš ï¸ 5. GESTION DES ERREURS

### Calcul ICT (Invalid Column per line Tolerance)
- [ ] **Calculer le % de colonnes invalides par ligne**
  - ICT = (nombre colonnes invalides / nombre total colonnes) Ã— 100
  - Exemple : 2 colonnes invalides sur 20 = 10%

- [ ] **Appliquer le seuil ICT**
  - Si ICT calculÃ© â‰¥ ICT configurÃ© (dÃ©faut: 10%)
  - â†’ Rejeter la ligne de la table "Last" (pas de "All")
  - â†’ IncrÃ©menter le compteur "lignes rejetÃ©es"

### Calcul RLT (Rejected Line per file Tolerance)
- [ ] **Calculer le % de lignes rejetÃ©es par fichier**
  - RLT = (nombre lignes rejetÃ©es / nombre total lignes) Ã— 100
  - Exemple : 15 lignes rejetÃ©es sur 100 = 15%

- [ ] **Appliquer le seuil RLT**
  - Si RLT calculÃ© â‰¥ RLT configurÃ© (dÃ©faut: 10%)
  - â†’ Rejeter tout le fichier
  - â†’ IncrÃ©menter le compteur "fichiers rejetÃ©s"

### Actions d'erreur configurables
- [ ] **ICT_DRIVEN (par dÃ©faut)**
  - IncrÃ©menter le compteur ICT
  - Appliquer la rÃ¨gle ICT (voir ci-dessus)

- [ ] **REJECT**
  - Rejeter immÃ©diatement la ligne
  - GÃ©nÃ©rer une ligne invalide dans table dÃ©diÃ©e
  - Appliquer la rÃ¨gle RLT

- [ ] **LOG_ONLY**
  - Logger l'erreur mais ne pas rejeter
  - Garder la donnÃ©e (mÃªme avec NULL)

### Reporting des erreurs
- [ ] **GÃ©nÃ©rer une table des lignes invalides** (optionnel)
  - Si configurÃ© "Invalid_lines_generated = true"
  - CrÃ©er une table avec toutes les lignes rejetÃ©es

---

## ğŸ“ˆ 6. MODES D'INGESTION

- [ ] **Mode FULL_SNAPSHOT (snapshot complet)**
  - UtilisÃ© pour : fichiers complets remplaÃ§ant les donnÃ©es prÃ©cÃ©dentes
  - Mettre Ã  jour la table "Last" avec le nouveau fichier
  - Ajouter le fichier Ã  la table "All" (historique)

- [ ] **Mode DELTA_FROM_FLOW (incrÃ©mental)**
  - UtilisÃ© pour : fichiers contenant uniquement les changements
  - Ne PAS mettre Ã  jour la table "Last"
  - Ajouter uniquement Ã  la table "All"

---

## âœ… 7. CONTRÃ”LES FINAUX

### VÃ©rification de complÃ©tude
- [ ] **S'assurer que tous les fichiers ont Ã©tÃ© traitÃ©s**
  - Calculer : fichiers ingÃ©rÃ©s + fichiers ignorÃ©s + fichiers rejetÃ©s + fichiers en erreur technique
  - Comparer avec le nombre de fichiers reÃ§us en entrÃ©e
  - Si diffÃ©rent â†’ lever une erreur au niveau du job

### GÃ©nÃ©ration du rapport
- [ ] **CrÃ©er un rapport d'exÃ©cution pour chaque fichier**
  - Nombre de lignes traitÃ©es
  - Nombre de lignes rejetÃ©es
  - Nombre de colonnes invalides
  - Temps de traitement
  - Statut final (succÃ¨s/Ã©chec)

---

## ğŸš€ 8. OPTION FAIL FAST (Ã  discuter - pas R1)

- [ ] **Configurer un seuil d'erreur global**
  - Exemple : arrÃªter si > 10% d'erreurs

- [ ] **ArrÃªter l'ingestion en cas de dÃ©passement**
  - Stopper immÃ©diatement le traitement
  - Rejeter le fichier avec erreur 000000007

---

## ğŸ“ 9. MÃ‰TADONNÃ‰ES

### Commentaires des colonnes
- [ ] **Ajouter les descriptions fonctionnelles**
  - Si colonne a un "Comment" dans la config
  - Ajouter ce commentaire dans les mÃ©tadonnÃ©es Delta de la colonne

### Nommage des tables
- [ ] **Appliquer les rÃ¨gles de nommage**
  - Si "last_table_name_conf" dÃ©fini â†’ utiliser ce nom
  - Sinon â†’ `<delta_table_name>_last`
  - Table All â†’ toujours `<delta_table_name>_all`

---

## ğŸ“Œ CODES D'ERREUR Ã€ RETENIR

| Code      | Signification                                    |
|-----------|--------------------------------------------------|
| 000000001 | Date invalide dans nom de fichier               |
| 000000002 | Fichier dÃ©jÃ  traitÃ© (doublon)                   |
| 000000003 | Fichier plus ancien que le prÃ©cÃ©dent            |
| 000000006 | Nombre de colonnes incorrect                    |
| 000000007 | Seuil fail-fast dÃ©passÃ©                         |

---

**RÃ©sumÃ© : ~50 points de contrÃ´le rÃ©partis en 9 catÃ©gories principales**
